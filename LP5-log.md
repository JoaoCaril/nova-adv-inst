# Lab 5 - Presential - Logging and plotting

## Lab Goals

Save data in a file sampled from an arduino and plot the graph in realtime via a websocket, running in the raspberry pi or in you VM.

## Goal 1 - Setup a server to plot the data in via a web page

We will setup a server on raspberry pi (or in your VM) to bot serve webpages and send data via a websocket.

A websocket is a comunication protocol enabling fast bidirectional comunication between a server and a/multiple client/s.

This protocol creates a persistent connection, which reduces the time needed to transfer data between two devices. Another advantage of being persistent is the hability of the server to send messages directly to a client (or even multiple) without being "asked", reducing the unwanted traffic in the network and the syncronization of multiple clients.


The first thing to do is run the server. In order to do that, copy the files in the folder ***LP5/Goal 1*** to your raspberry pi, and go to the folder were the server file is and type:

***python3 server.py***

This will lunch the server. Afterwards, go to a browser (remember that you have to be connected to the "pi" network) and navigate to http://Your(VM)RaspberryIp:9999.

You should then see a page (which is inside the static folder called example.html) where you can insert your raspberry's/VM IP and connect to it. If the autofill option is correct, just press the connect button.

If no error alert appears, the web page will start requesting a new sample every seconds and displaying it on the chart.

Both server.py and examples.html files have comments explaing what everything does.



## Goal 2

Now we will modify the server that we configured in Goal 1, to display sensor data acquired from an Android Phone

### Requirements

* From the Play Store, install in a Android Phone, the SensorDroid App
* In your virtual machine:
  * Install library: 
  * sudo pip3 install sensordroid
* Download the python Native Example programa SensorDroidNative.py form:
  * https://sites.google.com/view/sensordroid/getting-started/python
  * or from folder ***LP5/Goal 2/Server_acc/SensorDroid/***
* Check if the network settings of your VM is configured in Bridged Adapter mode
  * Devices -> Network -> Network Settings

### Testing SensorDroid
* On your mobile run the SensorDroid App
  * Explore the app the verify which sensors are available in your phone
* In the virtual machine do:
  * python3 SensorDroidNative.py
* You should see now a flow of numbers, with the real time data of the phone sensors

### Server_acc.py

In folder ***LP5/Goal 2/Server_acc/*** you will find a new version of the server.py that you tried in Goal 1. Instead of generation random data, this version of the server reads the accelerometer data of the phone and publish it through the websocket. Type:

***python3 server_acc.py***

Gp to the browser and navigate to http://Your(VM)RaspberryIp:9999

The chart will be now updated with the data generated by the accelerometer. The time resolution it will be dependent of requesting rate set in the html file.



## Goal 3

Change the code server_acc to:
* Read, simultaneously, different sensors of the phone
* Save the data in a file


## Additional note

## For audio related projects the students can use the following android app Eu encontrei esta app: 

https://play.google.com/store/apps/details?id=com.portable.lanmic&hl=pt_PT

And test the output with this code (to extract additional audio samples s.recv(N) should continue to be called): 

https://realpython.com/python-sockets/#echo-client

